\documentclass[12pt]{article}
\usepackage{geometry}
\usepackage{titlesec}
\usepackage{fontsize}
\usepackage{setspace}
\usepackage{listings} % 用于代码展示

\renewcommand{\normalsize}{\fontsize{14}{17}\selectfont}
\setlength{\parskip}{0pt} % 段落间距设为 0
\setlength{\parindent}{1.27cm} % 强制首行缩进

% 页面边距设置
\geometry{a4paper, left=1in, right=1in, top=1in, bottom=1in}

% lstlisting 设置
% lstlisting 设置
\lstset{
  basicstyle=\ttfamily\fontsize{12}{14}\selectfont, % 设置字体大小为 12pt，行间距为 14pt
  breaklines=true,                                  % 自动换行
  breakatwhitespace=true,                           % 在空白处换行
  columns=flexible,                                 % 修复字符间距问题
  frame=single,                                     % 添加边框
  numbers=left,                                     % 显示行号
  numberstyle=\fontsize{10}{12}\selectfont,         % 设置行号字体大小为 10pt，行间距为 12pt
  showstringspaces=false                            % 不显示空格标记
}


% Section 样式
\titleformat{\section}[block]
  {\normalfont\fontsize{25}{22}\bfseries\centering}
  {}{0em}{}[\titlerule]

% Subsection 样式
\titleformat{\subsection}[block]
  {\normalfont\fontsize{18}{20}\bfseries\centering}
  {}{0em}{}[\titlerule]

% Title 设置
\title{Bomberman Game README}
\author{}
\date{}

\begin{document}


\makeatletter
\renewcommand{\maketitle}{
  \begin{center}
    {\fontsize{36}{40}\bfseries \@title \par} % 主标题：字体大小 36pt，行间距 40pt，加粗
    \vskip 1em % 标题与正文的间距
    {\fontsize{14}{18} \@author \par} % 作者：字体大小 14pt，行间距 18pt
    \vskip 1em
    {\fontsize{12}{14} \@date \par} % 日期：字体大小 12pt，行间距 14pt
  \end{center}
}
\maketitle


\section*{Team Members}
- Elena Hu \\
- Chengyu Yu

\section*{Changes}

\subsection*{Gamestate Field Modification}


\hspace*{1.27cm}Removed the boom-cor field from the gamestate structure. This change was made after realizing that handling the countdown (from 2 to 0) for bomb explosions directly within the layout field simplifies the implementation. Retaining boom-cor to pass explosion ranges introduced bugs, which were resolved by this adjustment.

\indent Additionally, since the explosion effects are now directly updated in the layout, we adjusted the bomb countdown settings to start at 3 seconds and explode at 0 seconds, instead of the previous setup starting at 5 seconds, exploding at 2 seconds, and ending at 0 seconds.



\subsection*{Generating Layout}
\hspace*{1.27cm}We use a rule function as the input of the generating-layout function, so that we can use just one function to generate both homepage-layout and random-layout.  

\indent We also aimed to make the game map size scalable by implementing the following code snippet:  
\begin{lstlisting}
(define SCALE Integer)
(define MAX-ROWS (* 11 SCALE))
(define MAX-COLS (* 15 SCALE))
\end{lstlisting}

\indent When SCALE is set to 1, the game runs with the default 11x15 map size. By adjusting SCALE, we can expand the map while maintaining the same generation rules: fixed snowman positions, fixed safe zones in the top-left and top-right corners, and fixed player starting positions. However, we found that setting SCALE to 2 caused noticeable lag during gameplay. As a result, we ultimately decided to abandon this idea.

\subsection*{Modification of single-boom-range and extend-direction function}
\hspace*{1.27cm}Initially, our single-boom-range and extend-direction functions were designed as follows(code snippet):

\begin{lstlisting}
[potential-boom-range-except-center
 (list
  ;; up
  (list (make-cor cor-x (- cor-y 1))
        (make-cor cor-x (- cor-y 2)))
  ;; down
  (list (make-cor cor-x (+ cor-y 1))
        (make-cor cor-x (+ cor-y 2)))
  ;; left
  (list (make-cor (- cor-x 1) cor-y)
        (make-cor (- cor-x 2) cor-y))
  ;; right
  (list (make-cor (+ cor-x 1) cor-y)
        (make-cor (+ cor-x 2) cor-y)))]

[boom-range-except-center
 (map
  (lambda (potential-list)
    (extend-direction potential-list layout))
  potential-boom-range-except-center)]
\end{lstlisting}

\indent Since we aimed to achieve better scalability and avoid hardcoding (in this version, we had to manually list all potential coordinates in potential-list), we devised an alternative implementation(code snippet):

\begin{lstlisting}
[directions
 (list
  (lambda (n) (make-cor (cor-column center) (- (cor-row center) n)))
  (lambda (n) (make-cor (cor-column center) (+ (cor-row center) n)))
  (lambda (n) (make-cor (- (cor-column center) n) (cor-row center)))
  (lambda (n) (make-cor (+ (cor-column center) n) (cor-row center))))]

[boom-range-except-center
 (map
  (lambda (direction-fn)
    (extend-direction direction-fn layout))
  directions)]

(cons center
 (apply append boom-range-except-center))
\end{lstlisting}

\indent However, this implementation turned out to be much less readable. Ultimately, we decided to prioritize readability over scalability and chose to use the initial version as a balance between the two.

\subsection*{Chain-explosion}

\hspace*{1.27cm}We identified an issue in the previous implementation of the boom function, which failed to recursively compute chained explosions correctly. The function was rewritten to ensure that all chained explosions are properly handled. For example, a bomb at coordinate (0,0) cannot directly trigger a bomb at (0,4), but it can trigger a bomb at (0,2), which subsequently triggers the bomb at (0,4). The new implementation ensures that all affected bombs explode simultaneously through recursive propagation.


\subsection*{Updated Symbol System and modification in get-symbol function}
\hspace*{1.27cm}The symbol system was updated to provide a clearer representation of the game state:  
\begin{itemize}
  \item Introduce a new data type definition: Who. Use it in on-key part to avoid repeating codes due to the different players. \\
  Who is one of the following String: 
   \begin{itemize}
      \item "1"
      \item "2"
    \end{itemize}
 Interpretation: shortcuts for player. "1" stays for Player1, "2" stays for Player2.
  \item Single-letter symbols represent cells without players. For example:
    \begin{itemize}
      \item 'W: Walkable cell.
      \item 'I: Indestructible wall.
      \item 'D: Destructible wall.
    \end{itemize}
  \item Three-letter symbols represent cells occupied by players. The rules are:
    \begin{itemize}
      \item The first letter indicates the cell type (e.g., W, B for bombs).
      \item The second letter indicates the player (1 for Player 1, 2 for Player 2).
      \item The third letter indicates the player's current direction (U, D, L, R).
      \item Example: 'W1L means Player 1 is on a walkable cell facing left.
    \end{itemize}
  \item Two-letter symbols always start with E and represent the explosion effect's countdown timer.
    \begin{itemize}
      \item Example: 'E2 indicates the explosion effect will last for 2 more ticks.
    \end{itemize}
\end{itemize}

\indent Since the keyhandler functions need to retrieve the new symbol, we added a new symbol 'ILEGAL to represent the symbol out of bounds. As a result, the get-symbol function was also modified.

\subsection*{Optimization of Minor Issues}
\hspace*{1.27cm}We also addressed several minor issues, including the following:  

1. The implementation logic of the end? function was simplified. Since end? returns a Boolean, there is no need to use `cond` to specify the return value for each case. Instead, we used `or` for a more concise implementation.

2. Improved the usage of let and let*. We ensured that let* is only used when necessary and avoided its use in situations where `let` suffices.

3. After updating the symbol system, we had to use the following code to handle certain logic (e.g., movement logic):  
\begin{lstlisting}
(string->symbol (string-append ...))
\end{lstlisting}

\indent A better approach would have been to represent the layout as a vector of vectors of strings, thereby avoiding the need to convert between strings and symbols. However, considering that this issue had minimal impact, we ultimately decided not to make this change.

4. Split the previously monolithic file into separate modules:
\begin{itemize}
  \item on-tick
  \item on-key
  \item render
  \item stop-when
  \item public(containing shared functions like get-symbol, convert, in-bound?, and complete data definitions)
  \item big-bang
\end{itemize}

\indent This modularization improved the maintainability of the code and enhanced its future scalability.





















\end{document}




